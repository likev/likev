<!doctype html>
<html>
<head>
<meta charset='utf-8'>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

<title> Javascript绘制等值线</title>

<style>
#container {
	position:relative;
}

#draw {
//	position:absolute;
	left:0px;
	top:0px;
}

#map_canvas {
	height:800px;
	width:1400px;
}
</style>
<script src="jquery-1.6.2.min.js"></script>
<script src='Contour.js'></script>
<script src='data.js'></script>
<script type="text/javascript"
    src="https://maps.google.com/maps/api/js?sensor=false">
</script>
<script type="text/javascript">
  
  $(function(){
	//initialize_map()
    var latlng = new google.maps.LatLng(34.397, 115.644);
    var myOptions = {
      zoom: 6,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.TERRAIN
    };
    window.map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
  });
  
  $(function(){
	$('#draw').click(function(e){
		$('#map_canvas').click();
	})
	$('#draw').scroll(function(e){
		$('#map_canvas').scroll();
	})
  });
</script>

<script>
$(function(){

	
/*	
	var data = [
		[ grid(0,0,1),  grid(0,100,3.5),  grid(0,200,5.3)],
		[ grid(100,0,3),  grid(100,100,4.3),  grid(100,200,7)],
		[ grid(200,0,5),  grid(200,100,7),  grid(200,200,8)]
	];
	*/
	log('<br>');
	var mydata = [], mylevel = [];
	var k = 0, lat, lon;
	for(var i = latCount-1; i>=0; i-- ){
		
		mydata[i] = [];
		lat = 2.5*i + endLat;
		for(var j=0; j<lonCount; j++){
			lon = 2.5*j + beginLon;
			mydata[i][j] = grid(lat, lon, odata[k++]);
/*			
		  var marker = new google.maps.Marker({
			  position: new google.maps.LatLng(lat, lon), 
			  map: map, 
			  title: ' '+mydata[i][j].value
		  });
		  */
		}
	}
	
	for(var lat=beginLat; lat >= endLat; lat -= 2.5){
	
		var flightPath = new google.maps.Polyline({
			path: [new google.maps.LatLng(lat, beginLon), new google.maps.LatLng(lat, endLon)],
			strokeColor: "#666666",
			strokeOpacity: 0.8,
			strokeWeight: 1
		});

		flightPath.setMap(map);
	
	}
	for(var lon=beginLon; lon <= endLon; lon += 2.5){
	
		var flightPath = new google.maps.Polyline({
			path: [new google.maps.LatLng(beginLat, lon), new google.maps.LatLng(endLat, lon)],
			strokeColor: "#666666",
			strokeOpacity: 0.8,
			strokeWeight: 1
		});

		flightPath.setMap(map);
	
	}
/*	
//test data read
	for(var i = latCount-1; i>=0; i-- ){
		log(mydata[i][0].x +':  ');
		for(var j=0; j<lonCount; j++){

			log(mydata[i][j].value+' ');
		}
		log('<br>');
	}
*/
	for(var l = levelBegin; l<=levelEnd; l += levelSpan ){
		mylevel[mylevel.length] = l;
	}
	
//	console.log(mydata);
//	console.log(mylevel);
	
	
	var con = new Contour(mydata);
	
	con.setContourLevel(mylevel);
	var all_iso_line = con.track();

	
	for(var i in all_iso_line){
		var line = all_iso_line[i].path;
		var apath = [];
		for(var j=1; j< line.length; j++){
			apath.push(new google.maps.LatLng(line[j].x, line[j].y) );
		}
		
		 var flightPath = new google.maps.Polyline({
			path: apath,
			strokeColor: "#0000FF",
			strokeOpacity: 1.0,
			strokeWeight: 2
		});

		flightPath.setMap(map);
	}

})
</script>
</head>

<body>
<div id='log'></div>
<div id='container'>
	<div id='map_canvas'>
	</div>
	<canvas id='draw' width=1400 height=800>
	浏览器不支持canvas！
	</canvas>
</div>
</body>
</html>

